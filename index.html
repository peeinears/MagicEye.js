<!doctype html>
<html>
<head>
  <title>MagicEye.js</title>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="MagicEye.js is a JavaScript library for generating \"Magic Eye\" images (single image random dot stereograms, or SIRDS) in the browser." name="description" />
  <meta content="Magic Eye, MagicEye, javascript, js, magiceye.js, stereogram, autostereogram, SIRDS" name="keywords" />
  <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700italic,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=PT+Serif' rel='stylesheet' type='text/css'>
  <link href="assets/styles.css" media="all" rel="stylesheet" type="text/css" />
</head>
<body>
  <header>
    <h1>MagicEye.js</h2>
    <div>
      <span>by Ian Pearce</span>
      &bull; 
      <a href="https://github.com/peeinears/MagicEye.js">Fork on Github</a>
    </div>
  </header>
  <section>
    <canvas id="canvas" width="1000" height="600">Sorry, your browser doesn't support HTML5 Canvas!</canvas>
    <img id="magiceye" width="1000" height="600" style="display: none;" src />
    <div class="buttons">

      <form name="brush" style="display: none;">
        <div class="brush-swatches">
          <input name="value" type="radio" class="brush-value" id="brush-100" value="100" />
          <label for="brush-100"></label>
          <input name="value" type="radio" class="brush-value" id="brush-75" value="75" />
          <label for="brush-75"></label>
          <input name="value" type="radio" class="brush-value" id="brush-50" value="50" />
          <label for="brush-50"></label>
          <input name="value" type="radio" class="brush-value" id="brush-25" value="25" />
          <label for="brush-25"></label>
          <input name="value" type="radio" class="brush-value" id="brush-0" value="0" />
          <label for="brush-0"></label>
        </div>

        <div class="brush-sizes">
          <input name="size" type="radio" class="brush-size" id="sm-brush" value="10" />
          <label for="sm-brush"></label>
          <input name="size" type="radio" class="brush-size" id="md-brush" value="20" />
          <label for="md-brush"></label>
          <input name="size" type="radio" class="brush-size" id="lg-brush" value="40" />
          <label for="lg-brush"></label>
        </div>
      </form>

      <div class="clearfix"></div>

      <button id="show-magiceye">Show Magic Eye</button>
      <button id="show-canvas">Show Depth Map</button>
      <button id="redraw">Redraw Shapes</button>
      <button id="draw-mode">Draw Your Own!</button>
      <button id="back-to-shapes" style="display: none;">Back to Shapes</button>
      <button id="clear" style="display: none;">Clear</button>

    </div>
  </section>
  <section>
    <hr></hr>
    <p>
      <a href="https://github.com/peeinears/MagicEye.js">MagicEye.js</a> is a JavaScript library for generating "Magic Eye" images in the browser. Technically, it generates single-image random dot stereograms, or SIRDS.
    </p>
    <p>
      In the above example, pixel values from an HTML5 Canvas are turned into depth data, which are then used to generate a Magic Eye image. The code looks something like this:
    </p>
    <pre>var canvas = document.getElementById('canvas');
MagicEye.render({
  el: 'magiceye',
  depthMapper: new MagicEye.CanvasDepthMapper(canvas)
});</pre>
    <p>
      More info about MagicEye.js and how to use it can be found on <a href="https://github.com/peeinears/MagicEye.js">Github</a>.
    </p>
    <p>Fork and enjoy!</p>
    <hr></hr>
    <h2>More demos:</h2>
    <p>
      <a href="text-to-magiceye.html">Text to Magic Eye</a> and <a href="jpg-to-magiceye.html">Image to Magic Eye</a>
    </p>
  </section>
  <footer>
    <span>Ian Pearce</span>
    &bull; 
    <a href="https://github.com/peeinears/MagicEye.js">Github</a>
  </footer>

  <script type="text/javascript" src="magiceye.js"></script>
  <script type="text/javascript" src="depthmappers/CanvasDepthMapper.js"></script>

  <script>
    (function() {

      var canvas = document.getElementById("canvas"),
          context = this.canvas.getContext("2d"),
          magicEye = document.getElementById("magiceye"),
          drawMode = false,
          showingMagicEye = false;

      window.addEventListener('resize', resize, false);

      document.getElementById('show-magiceye').onclick = function () {
        renderMagicEye();
        canvas.style.display = 'none';
        magicEye.style.display = 'block';
        document.getElementById('show-magiceye').style.display = 'none';
        document.getElementById('show-canvas').style.display = 'inline';
        showingMagicEye = true;
      };

      document.getElementById('show-canvas').onclick = function () {
        magicEye.style.display = 'none';
        canvas.style.display = 'block';
        document.getElementById('show-magiceye').style.display = 'inline';
        document.getElementById('show-canvas').style.display = 'none';
        showingMagicEye = false;
      };

      document.getElementById('redraw').onclick = function () {
        redraw();
        if (showingMagicEye) {
          renderMagicEye();
        }
      };

      document.getElementById('clear').onclick = function () {
        clear();
        if (showingMagicEye) {
          document.getElementById('show-canvas').click();
        }
      };

      for (var i = 0; i < document.brush.value.length; i++) {
        document.brush.value[i].onchange = function () {
          brush.value = Math.ceil(parseInt(getRadioVal(document.brush, 'value')) * 255 / 100);
        };
      };

      for (var i = 0; i < document.brush.size.length; i++) {
        document.brush.size[i].onchange = function () {
          brush.size = parseInt(getRadioVal(document.brush, 'size'));
        };
      };

      function getRadioVal(form, name) {
        if (typeof form.elements[name].value !== undefined) return form.elements[name].value;
        var val, radios = form.elements[name];
        for (var i = 0; i < radios.length; i++) {
          if ( radios[i].checked ) {
            val = radios[i].value;
            break;
          }
        }
        return val;
      }

      function renderMagicEye() {
        MagicEye.render({
          el: 'magiceye',
          colors: generatePalette(10),
          depthMapper: new MagicEye.CanvasDepthMapper(document.getElementById('canvas'))
        });
      }

      function randomRGBa() {
        return [Math.floor(Math.random() * 256),
                Math.floor(Math.random() * 256),
                Math.floor(Math.random() * 256),
                255];
      }

      function generatePalette(numColors) {
        var palette = [];
        for (var i = 0; i < numColors; i++) {
          palette.push(randomRGBa());
        }
        return palette;
      }

      function redraw() {
        var fill, i,
            width = canvas.width,
            height = canvas.height,
            shapes = 5,
            shade = 255 / shapes;

        clear();

        for (i = shapes - 1; i >= 0; i--) {
          fill = Math.round(shade * i);
          context.fillStyle = 'rgb(' + fill + ',' + fill + ',' + fill + ')';
          context.beginPath();
          context.moveTo(Math.floor(Math.random() * width), Math.floor(Math.random() * height));
          context.lineTo(Math.floor(Math.random() * width), Math.floor(Math.random() * height));
          context.lineTo(Math.floor(Math.random() * width), Math.floor(Math.random() * height));
          context.fill();
        }
      }

      function clear() {
        context.fillStyle = "#ffffff";
        context.fillRect(0, 0, canvas.width, canvas.height);
      }
    
      function resize() {
        magicEye.width = canvas.width = window.innerWidth > 1000 ? 1000 : window.innerWidth;
        redraw();
      }


      // -- drawing code

      document.getElementById('draw-mode').onclick = function () {
        drawMode = true;
        canvas.style.border = '1px solid #aaa';
        document.getElementById('redraw').style.display = 'none';
        this.style.display = 'none';
        var clearBtn = document.getElementById('clear');
        clearBtn.click();
        clearBtn.style.display = 'inline';
        document.brush.style.display = 'inline';
        document.getElementById('back-to-shapes').style.display = 'inline';
      }

      document.getElementById('back-to-shapes').onclick = function () {
        drawMode = false;
        canvas.style.border = 'none';
        document.getElementById('redraw').style.display = 'inline';
        this.style.display = 'none';
        var clearBtn = document.getElementById('clear');
        clearBtn.click();
        clearBtn.style.display = 'none';
        document.brush.style.display = 'none';
        document.getElementById('draw-mode').style.display = 'inline';
        redraw();
        document.getElementById('show-magiceye').click();
      }

      var px, py,
          drawing = false;
          x = 0,
          y = 0;

      var brush = {
        value: 0,
        size: 10,
        opacity: 0.5
      };

      function draw(x, y, w, v, a) {
        if (!drawMode) return;
        var gradient = context.createRadialGradient(x, y, 0, x, y, w);
        gradient.addColorStop(0, 'rgba(' + v + ',' + v + ',' + v  + ',' + a + ')');
        gradient.addColorStop(1, 'rgba(' + v + ',' + v + ',' + v  + ',0)');
        
        context.beginPath();
        context.arc(x, y, w, 0, 2 * Math.PI);
        context.fillStyle = gradient;
        context.fill();
        context.closePath();
      };

      canvas.onmousedown = function (e) {
        if (!drawMode) return;
        drawing = true;
        px = e.pageX - canvas.offsetLeft;
        py = e.pageY - canvas.offsetTop;
        draw(px, py, brush.size, brush.value, brush.opacity);
      };

      document.body.onmouseup = function () {
        if (!drawMode) return;
        drawing = false;
      };

      canvas.onmousemove = function (e) {
        if (!drawMode) return;
        if (drawing) {
          x = e.pageX - canvas.offsetLeft;
          y = e.pageY - canvas.offsetTop;
          
          var dis = Math.sqrt(Math.pow(px - x, 2) + Math.pow(px - y, 2));

          for (var i = 0; i < dis; i++) {
            var s = i / dis;
            draw(px * s + x * (1 - s), py * s + y * (1 - s), brush.size, brush.value, brush.opacity);
          }
          px = x;
          py = y;
        }
      };

      resize();

      document.brush.size[2].click();
      document.brush.value[4].click();
      document.getElementById('show-magiceye').click();

    })();
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-57234045-1', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
