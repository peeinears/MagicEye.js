<!doctype html>
<html>
<head>
  <title>Image &rarr; MagicEye</title>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="MagicEye.js is a JavaScript library for generating \"Magic Eye\" images (single image random dot stereograms, or SIRDS) in the browser." name="description" />
  <meta content="Magic Eye, MagicEye, javascript, js, magiceye.js, stereogram, autostereogram, SIRDS" name="keywords" />
  <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700italic,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=PT+Serif' rel='stylesheet' type='text/css'>
  <link href="assets/styles.css" media="all" rel="stylesheet" type="text/css" />
  <style>
    #file-input {
      visibility: hidden;
      width: 0;
      height: 0;
    }

    #magic-eye {
      max-width: 100%;
      height: auto;
      margin: 0 auto;
      display: none;
    }
    #magic-eye[src] {
      display: block;
    }
  </style>
</head>
<body>
  <header>
    <h1>Image &rarr; Magic Eye</h2>
    <div>
      <span>by Ian Pearce</span>
      &bull; 
      <a href="https://github.com/peeinears/MagicEye.js">Fork on Github</a>
    </div>
  </header>
  <section>
    <canvas id="canvas-preview" style="display: none;"></canvas>
    <input id="file-input" type="file" accept="image/*">
    <img id="magic-eye"/>
    <div class="buttons">

      <label for="file-input" class="button">Choose Image</label>
      <button id="change-colors">Change Colors</button>
      <button id="black-and-white">Black and White</button>

    </div>
  </section>
  <section>
    <hr></hr>
    <p>
      This page lets you convert your own depth map images into Magic Eyes.
    </p>
    <p>
      Your image should be black and white (greyscale). The lighter a region is, the closer it will appear.
      <a href="examples/trike.jpg">Check out this example of a tricycle.</a>
    </p>
    <p>
      There's no server, so your images don't actually get uploaded anywhere.
    </p>
    <hr></hr>
  </section>
  <footer>
    <span>Ian Pearce</span>
    &bull; 
    <a href="https://github.com/peeinears/MagicEye.js">Github</a>
  </footer>

  <script type="text/javascript" src="magiceye.js"></script>
  <script type="text/javascript" src="depthmappers/CanvasDepthMapper.js"></script>

  <script>
    (function() {

      var blackAndWhite = false;
      var input = document.querySelector('input#file-input');

      input.addEventListener('change', function () {

        var magiceye = document.querySelector('img#magic-eye');
        var canvas   = document.querySelector('canvas#canvas-preview');
        var file     = input.files[0];
        var url      = URL.createObjectURL(file);
        var img      = new Image();
        img.onload = function () {
          magiceye.width = canvas.width = img.width;
          magiceye.height = canvas.height = img.height;
          var ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0);
          renderMagicEye();
        };
        img.src = url;
      });

      function renderMagicEye() {
        var canvas = document.querySelector('canvas#canvas-preview');
        MagicEye.render({
          el: 'magic-eye',
          colors: blackAndWhite ? [[0, 0, 0, 255], [255, 255, 255, 255]] : generatePalette(10),
          depthMapper: new MagicEye.CanvasDepthMapper(canvas, { inverted: false })
        });
      }

      document.getElementById('change-colors').onclick = function () {
        blackAndWhite = false;
        renderMagicEye();
      };

      document.getElementById('black-and-white').onclick = function () {
        blackAndWhite = true;
        renderMagicEye();
      };

      function randomRGBa() {
        return [Math.floor(Math.random() * 256),
                Math.floor(Math.random() * 256),
                Math.floor(Math.random() * 256),
                255];
      }

      function generatePalette(numColors) {
        var palette = [];
        for (var i = 0; i < numColors; i++) {
          palette.push(randomRGBa());
        }
        return palette;
      }

    })();
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-57234045-1', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
