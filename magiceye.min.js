(function(){var e={render:function(t){t=t||{};var r,o,n,a,i,h,p={width:null,height:null,depthMap:null,depthMapper:new e.DepthMapper,imageType:"png",colors:[[255,255,255,255],[0,0,0,255]]};for(var f in p)t.hasOwnProperty(f)||(t[f]=p[f]);if(t.el&&(r="string"==typeof t.el?document.getElementById(t.el):t.el,!r||!r.tagName))throw new Error("Could not find element: "+t.el);if(o=t.width||r.width,n=t.height||r.height,!o)throw new Error("Width not set and could not be inferred from element: "+t.el);if(!n)throw new Error("Hight not set and could not be inferred from element: "+t.el);if(t.depthMap)a=t.depthMap;else{if(!t.depthMapper)throw new Error("No depthMap or depthMapper opts given");a=t.depthMapper.generate(o,n)}for(h=0;h<t.colors.length;h++)"string"==typeof t.colors[h]&&(t.colors[h]=this.helpers.hexToRGBa(t.colors[h]));switch(i=this.generatePixelData({width:o,height:n,depthMap:a,colors:t.colors}),r.tagName){case"CANVAS":this.renderToCanvas(r,i,o,n);break;case"IMG":var l=document.createElement("canvas");l.width=o,l.height=n,this.renderToCanvas(l,i,o,n),r.src=l.toDataURL("image/"+(t.imageType||"png"));break;default:throw new Error("el must be either a <canvas> or an <img>")}return this},renderToCanvas:function(e,t,r,o){var n=e.getContext("2d"),a=n.createImageData(r,o);a.data.set(t),n.putImageData(a,0,0)},generatePixelData:function(e){var t,r,o,n,a,i,h,p,f,l,s,c,d,u,g=e.width,w=e.height,m=e.depthMap,y=e.colors.length,M=72,v=Math.round(2.5*M),E=1/3,x=new Uint8ClampedArray(g*w*4);for(r=0;r<w;r++){for(u=new Uint16Array(g),t=0;t<g;t++)u[t]=t;for(t=0;t<g;t++)if(s=m[r][t],l=Math.round((1-E*s)*v/(2-E*s)),n=Math.round(t-(l+(l&r&1))/2),a=n+l,n>=0&&a<g){h=1;do p=s+2*(2-E*s)*h/(E*v),i=m[r][t-h]<p&&m[r][t+h]<p,h++;while(i&&p<1);if(i){for(f=u[n];f!==n&&f!==a;f=u[n])f<a?n=f:(n=a,a=f);u[n]=a}}for(t=g-1;t>=0;t--)if(c=r*g*4+4*t,u[t]===t)for(d=e.colors[Math.floor(Math.random()*y)],o=0;o<4;o++)x[c+o]=d[o];else for(c=r*g*4+4*t,o=0;o<4;o++)x[c+o]=x[r*g*4+4*u[t]+o]}return x},helpers:{hexToRGBa:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,r,o){return t+t+r+r+o+o});var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16),255]:null}}},t=function(){};t.prototype.autoResize=!0,t.prototype.make=function(){return[[0]]},t.prototype.generate=function(e,t){return this.autoResize?this.resize(this.make(e,t),e,t):this.make(e,t)},t.prototype.resize=function(e,t,r){var o,n,a,i=[],h=e.length,p=e[0].length;if(p===t&&h===r)return e;for(a=0;a<r;a++)for(i[a]=new Float32Array(t),o=Math.floor(a*h/r),n=0;n<t;n++)i[a][n]=e[o][Math.floor(n*p/t)];return i},t.extend=function(e){function t(e){var t,r;if(!e||"function"!=typeof e&&"object"!=typeof e)return e;for(var o=1,n=arguments.length;o<n;o++){t=arguments[o];for(r in t)e[r]=t[r]}return e}var r,o=this;r=e&&hasOwnProperty.call(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)};var n=function(){this.constructor=r};return n.prototype=o.prototype,r.prototype=new n,e&&t(r.prototype,e),r.__super__=o.prototype,r},e.DepthMapper=t,this.MagicEye=e}).call(this);